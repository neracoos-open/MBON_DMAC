Last edited: 11/19/2024
Last edited by: AEC
# MBON eDNA README

## File Overview
- `mbon_area_GBIF_fish_species_list`
	- File containing fish species and the corresponding number of obesrvations found in GBIF, generated by Jeff 
- `MBON_TERNS_eDNA_field_metadata`
	- File containing field metadata corresponding with our samples, generated by Aliya.
- `MBON_TERNS_OCT10BLAST_GBIF_CORRECTED`
	- File containing Jeff's full raw output, mostly unchanged aside from some things which are detailed in the Readme file
- `MBON_TERNS_OCT10BLAST_GBIF_CORRECTED_SequencingMetadata`
	- The "metadata" sheet from Jeff's raw output (file 3) extracted to a .csv file
- `MBON_TERNS_OCT10BLAST_GBIF_CORRECTED_UPDATED_ASVs_ANNOTATED`
	- File containing ASV reads per sample and their identifications from the Updated_ASVs sheet in Jeff's raw output along with manual annotation checks. Process for adding annotations described in Readme.
	
## Explanation of Datasheet Descriptions
- Overall description of the data is provided, followed by detailed descriptions of the columns and any changes made (post-hoc changes) to the original version supplied on October 10th 2024 by Jeff.

- Columns are described for each data sheet when they need explanation and have not been described in previous datasheet column description. 

### Additional Information
The taxonomic identifications assigned in the original output from Jeff's bioinformatics workflow from October 10th 2024 were assigned via three methods: 
1) "old VSEARCH" method which used only VSEARCH to assign IDs
2) "VSEARCH/sklearn hybrid" method which integrates VSEARCH and sklearn to generate an ID
3) GBIF_BLAST which uses blast to assign an ID for species within a GBIF buffer area. 

Different methods were used across different columns and datasheets; which of these methods was used is described throughout the metadata document where relevant using the language above. 



## MBON_TERNS_OCT10BLAST_GBIF_CORRECTED
- `.xslx` file containing the output from Jeff's bioinformatics workflow from October 10th 2024. The file contains multiple datasheets described below.
- Very few changes were made to this; any changes made were described fully below.

### Sheets
#### ASVs_sklearn
Wide-form dataset containing the number of reads per sample of all ASVs, with ASV identification made via VSEARCH/sklearn hybrid method

- no changes made from original output
- column info:
	 - (A) ASVID: unique identifier of ASV. Derived from the ASV sequence itself
	 - (B) Confidence:  Level of confidence reported at the level at which the ASV was classified (ie: Species level) by the Naive Bayes kmer classifier. (confidence parameter cutoff default value is 0.70, we set to X)
	 - (C) Consensus: ASVs share that taxonomic assignment (min-consensus parameter default is 0.51). 
	 - (D) Method: sequence identification method (sklearn or VSEARCH via VSEARCH/sklearn hybrid)
     - (M) Total_reads: total number of reads of unique ASV across all samples
	 - (N) Sample_Pos: count of samples that have greater than 0 reads for the ASV
	 - (NX) Seq: DNA sequence of the ASV, each unique 

- Additional info:
	- (B) Confidence: (similar to RDP Wang classifier and the Mothur classifier) "The confidence of a classification is calculated by bootstrapping (subsampling) the bag of 8-mers 100 times, and seeing how many times the subsample comes up with the same classification as the full read." (citation: https://doi.org/10.1186/s40168-018-0470-z form discussion: https://forum.qiime2.org/t/how-is-the-confidence-calculated-with-taxa-assignments/
	- (D) Method: 
		- VSEARCH/sklearn hybrid: performs VSEARCH exact match between query and reference_reads to find exact matches, followed by least common ancestor consensus taxonomy assignment from among maxaccepts top hits, min_consensus of which share that taxonomic assignment. Query sequences without an exact match are then classified with a pre-trained sklearn taxonomy classifier to predict the most likely taxonomic lineage. Trains the classifier on a sub-set of the full mitofish reference database. The mitofish database is subsetted by extracting the entries that would be expected to be amplified with the mifish primer. However, we have found that some species are amplified with mifish, but are not succesfully extracted/subsetted from the full database to train the naive bayes classifier, which results in unseen sequences and unknown classifications of ASVs in the samples. To prevent these false negatives, we also use a classification method (see VSEARCH) that does not require subsetting the reference database.   
		- VSEARCH: Performs VSEARCH global alignment between query and reference_reads, then assigns consensus taxonomy to each query sequence from among maxaccepts top hits, min_consensus of which share that taxonomic assignment.
		- BLAST: When the  two methods above results in unknown/unassigned or wrong classification (according to GBIF), we simply asked: for each ASV, are there any local species among the top 5 blast hits? If a sequence can be unambigously assigned to a local taxa, we update it here. 


#### OUTs_sklearn
Wide-form dataset containing the number of reads per sample of all taxonomic identifications (summed across ASVs with like IDs) for identifications made via VSEARCH/sklearn hybrid method only
- no changes made from original output
- to generate this df, all ASVs with the same taxonomic identification were summed to produce reads for each sample
- column info:
	(NR) drop: JEFF? 
		- This is a meaningless column that can be removed. I found where it was added.

#### ASVs_sklearn+VSEARCH+blast
Wide-form dataset containing the number of reads per sample of all ASVs, with ASV identification made via VSEARCH/sklearn hybrid method in some columns, old VSEARCH method in other columns, and blast method in other columns
- no changes made from original output
- column info:
	- (D) Method: sequence identification method (sklearn or VSEARCH via VSEARCH/sklearn hybrid)
	- (E:L) Kingdom through Common: taxonomy identified via VSEARCH/sklearn hybrid method
	- (P:U) VS_Kingdom through VS_Species: taxonomy assigned by old VSEARCH method
	- (W:Y) species_king through species_sci: kingdom, common name, and species name of the top blast hits seperated by ';'
	- (Z) evalue: evalue assigned by nucleotide blast
	- (AA) pident: percent identity assigned by nucleotide blast
	- (AB) is.fish: yes/no of whether genus + species matches an entry in the mitofish reference database

#### sklearn+blast+GBIF_UPDATES
Taxonomic information for each ASV based on VSEARCH/sklearn hybrid method OR GBIF_blast method
- changes made from original output: 
	- Column E was added and populated (described below)
	- Columns F:M were populated with additional data (described below).
- column info:
	- (D) Method: sequence identification method (sklearn or VSEARCH)
	- (E) MethodApproach: approach used to get VSEARCH or sklearn identification. "VSEARCH sklearn hybrid" or "old VSEARCH". The first refers to the VSEARCH/sklearn hybrid method while the second refers to the old VSEARCH method. This column was added post-hoc; any rows with "VSEARCH sklearn hybrid" were generated by the original output, any with "old VSEARCH" were added post-hoc. 
	- (F:M) Kingdom through Common: taxonomy identified via VSEARCH/sklearn hybrid method for all observations with "VSEARCH sklearn hybrid" in column E, or via the old VSEARCH method if "old VSEACRH" in column D. Any taxonomic ids with "old VSEARCH" corresponding in column D were added post-hoc from the ASVs_sklearn+VSEARCH+blast sheet (from columns VS_Kingdom through VS_Species (P:U)), as that sheet had IDs from the old VSEARCH method while the current one didn't.
	- (P) Qiime_in_GBIF: identification of whether the species identified via VSEARCH/sklearn hybrid method is present in the GBIF buffer area ---JEFF? (yes)
	- (Q) BLAST_in_GBIF: identification of whether the species identified via nucleotide blast is present in the GBIF buffer area ---JEFF? (yes)
	- (R) BLAST_GBIF_GUESS: species ID guess from BLAST_GBIF method? filled in if column P != NA? ---JEFF? (Returns genus + species when there was only one top blast match that is found in the GBIF fish list)
	- (S) BLAST_GBIF_GUESS_in_refdb: identification of whether the species identified in column Q is present in the reference database? ---JEFF? (Yes, so that we can use the reference database taxonomy levels when we guess a new genus+species of fish)

#### Updated_ASVs
Wide-form dataset containing the number of reads per sample of all ASVs, with ASV identification made across all identification methods
- this is the most updated ASV file in the output 
- change made from original output:
	- TERN project samples from 2022 were labeled 1-1,1-2,1-3, etc, which leds to formatting issues in excel. The sample IDs for those samples were changed to 1_1,1_2, etc. in row 1 columns KJ-NP
	- Columns E:H in the original output were deleted because they were accidental duplicates of columns A:D (still present in sheet)
	- Column E was added and populated (described below, same process as for corresponding columns in sklearn+blast+GBIF_UPDATES sheet)
	- Columns F:M were populated with additional data (described below, same process as for corresponding columns in sklearn+blast+GBIF_UPDATES sheet).
- column info:
	- (D) Method: sequence identification method (sklearn or VSEARCH or BLAST_GBIF).
	- (E) MethodApproach: approach used to assign taxonomy. "VSEARCH sklearn hybrid and BLAST_GBIF" or "old VSEARCH". The first refers to the VSEARCH/sklearn hybrid method integrated with BLAST_GBIF method, while the second refers to the old VSEARCH method. This column was added and populated post-hoc.  
	- (F:M) Kingdom through Common: taxonomy assigned via hybrid VSEARCH/sklearn method OR through BLAST method if "VSEARCH sklearn hybrid and BLAST_GBIF" in column D or via old VSEARCH method if "old VSEARCH" in column D. Any taxonomic ids with "old VSEARCH" corresponding in column D were added post-hoc from the ASVs_sklearn+VSEARCH+blast sheet (from columns VS_Kingdom through VS_Species (P:U)), as that sheet had IDs from the old VSEARCH method while the current one didn't.

#### Updated_OTUs
Wide-form dataset containing the number of reads per sample of all taxonomic identifications (summed across ASVs with like IDs) for identifications made via VSEARCH/sklearn hybrid or GBIF_BLAST method
- no changes made from original output
- column info:
	- (A:H) Kingdom through Common: taxonomy assigned via methods identified in "Updated_ASVs" sheet ---JEFF? (Once ASVs are updated with the new blast/gbif guesses, we re-tally the number of reads per OTU (species in this case) across the samples)
- note: this sheet was generated BEFORE the post-hoc addition of "old VSEARCH" IDs to the Updated_ASVs df, so those ASVs would be left out of this summary table. So, don't use it.

#### non_fish
Wide-form dataset containing the number of reads per sample of all non-fish taxonomic identifications (summed across ASVs with like IDs) for identifications made via VSEARCH/sklearn hybrid or GBIF_BLAST method
- column info: all columns identified previously

#### metadata
long-form dataset containing bioinformatics metadata information for each replicate. 
Note: Columns B-H are from the denoising stage by DADA2 (identifying ASVs). Each column is the number of reads that make it through the stages of denoising. ( cite https://doi.org/10.1038/nmeth.3869 )
- column info:
	- (A) SampleID: unique sample ID for each replicate
	- (B) input:---JEFF? 
		- The number of paired reads that made it to as input into the denoising step. Raw sequences go through a filtering program called 'fastp' for poly-g/quality filters, and then to 'cutadapt' (paired sequences that contain the primer sequence, which are subsequently trimmed off of the sequences)). fastp filters poly-g tails longer than 4 base-pairs, and tails where a sliding window of 2 basepairs drops below a quality score of 25. Reads are thrown out if the remaining read is not loger than 100 bp. Cutadapt then discards read pairs that do not have match of 88% or better for the forward and reverse primer sequences.
	- (C) filtered:---JEFF? 
		- Number of reads that made it through the the inital length filter of DADA2. Reads are trimmed to 110 bp long for the foward read, and the reverese reads is trimmed to 105.   Reads are filtered if they were already shorter than these lengths. Choosing lengths near the expected overlap between the reads will cut down on the number of large, off-target bacterial amplicons. 
	- (D) percentage_of_input_passed_filter:---JEFF? 
		- the percentage of reads as calculated from the previous two columns
	- (E) denoised:---JEFF?
		- Number of reads input to the merging step. same as C
	- (F) merged:---JEFF?
		- Number of reads that had sufficient overlap between the forward and reverse read to be merged into an ASV. We left it at default settings of 12 base pairs of overlap needed between each read pair.
	- (G) percentage_of_input_merged:---JEFF?
		- Percentage calculated from previous columns
	- (H) non.chimeric:---JEFF?
		- There are chimera filters to filter out adapter dimmers and other artifacts. This column indicates the number of read pairs that make it through this filter
	- (I) run: which sequencing run the sample was processed in ---JEFF?
		- The lable that the Watts and HCGS labs used to ID each set of samples sequenced together
	- (J) project: project sample is associated with (MBON or TERNS)
	- (K) KEEP:---JEFF?
		- There were a number of samples that were sequenced multiple times. This column has a 'keep' for the final samples that were retained to generate the tables.
	- (L) sample.blank: identification of whether the replicate is a water sample (SAMPLE) or a field blank (BLANK)
	-  (M) FUREY_ID: original ID assigned by FME lab
	- (N) project_year: code containing project and year the sample was processed in (not necessarily the year the sample was collected)
	- (O) YEAR: year the sample was processed in (not necessarily the year the sample was collected)
	- (P) TYPE: identification of whether the replicate is a water sample (SAMPLE) or field blank (TB)

#### fixed_OTUs
list of OTUs that were updated from their original ID (via VSEARCH/sklearn hybrid method?) based on BLAST_GBIF results
- column info:
	- (A) qiime_species: ---JEFF?
		- the species that qiime incorrectly identified, or NONE if qiime did not return a species classification for the ASVs
	- (B) BLAST_GBIF_species: ---JEFF?
		- The species reclassification based on GBIF and BLAST

#### reads_asigned_to_fish
long-form dataset containing number of reads per sample (number of reads that made it through filtering/denoising and merging?)
- column info:
	- (A) sample: replicate ID (same as SampleID column in metadata document)
	- (B) reads_assigned: number of reads assigned to fish in the sample 

## MBON_TERNS_OCT10BLAST_GBIF_CORRECTED_UPDATED_ASVs_ANNOTATED
- `.csv` file containing ASV reads across samples and their identifications from the Updated_ASVs sheet in MBON_TERNS_OCT10BLAST_GBIF_CORRECTED along with manual annotation checks (column "AnnotatedID").
- most of the annotated IDs were done using a previous workflow output (annotated IDs were in files: MBON_TERNS_JUN26BLAST_GBIF_CORRECTED_AECSEPT19_ASVAnnotation.csv and 
MBON_TERNS_SEPT27BLAST_GBIF_CORRECTED_ASV_GBIF_BLAST_UPDATES_ANNOTATED_OCT3_AECworkingOct3.csv in the ~MBON eDNA Data Sharing>eDNA Results>ASV Merging Data folder) that contained a different set of samples, so this resulting dataset was made by merging our annotations from the ASVs from the previous output (files mentioned above) into the Updated_ASVs sheet from the most recent workflow (pulled after all post-hoc changes, MBON_TERNS_OCT10BLAST_GBIF_CORRECTED_UPDATED_ASVs.csv in ~MBON eDNA Data Sharing>eDNA Results>ASV Merging Data folder). Additional annotations were added after this initial merging, as new ASVs were present in the new output that hadn't been present in the old sample set.
- column info:
	- (F:M) Kingdom through Common: taxonomy assigned via hybrid VSEARCH/sklearn method OR through BLAST method if "VSEARCH sklearn hybrid and BLAST_GBIF" in column D or via old VSEARCH method if "old VSEARCH" in column D. Any taxonomic ids with "old VSEARCH" corresponding in column D were added post-hoc from the ASVs_sklearn+VSEARCH+blast sheet (from columns VS_Kingdom through VS_Species (P:U)), as that sheet had IDs from the old VSEARCH method while the current one didn't.
	- (Q) scomnames : common names coming from the BLAST_GBIF method ---JEFF?
	- (R) FureyOpinion: expert opinion on whether the species identified should occur in our samples
	- (S) ManualBlast: results from manual blast of sequence. See "eDNA Annotation Documentation" word document for description of how species get placed in this column.
	- (T) Comment: percent identity and other comments to describe species in column AB
	- (U) AnnotatedID: final taxonomic assignment for each ASV. See "eDNA Annotation Documentation" word document for description of how species get placed in this column.
	- (V) AnnotationIDCaldwellComment: comment associated with taxonomy assigned to column AD.
	- (W:OE) MBNH6072311D through X6_3: number of reads of each ASV in each sample

## MBON_TERNS_eDNA_field_metadata
- `.csv` file containing field metadata from all MBON and TERN sampling. 
- column info:
	- (D) Time: time in EST of sampling
	- (E) FMESampleID: unique ID assigned to each replicate by FME lab
	- (F) SampleID: unique replicate ID assigned by Watts lab and used in bioinformatics results
	- (G) Sample: unique identifier for each sample (i.e. all water sample replicates for a given sample, with blanks seperated out into their own unique sample) 
	- (I) DepthCode: sampling depth code; S=surface, D=bottom
	- (J:L) AlternateID1 through AlternateID3: alternate IDs that may have been assigned to replicates in the past; typically the same as SampleID or FMESampleID just with information in a different order.
	- (M) SampleType: water sample (sample) or field blank (blank)
	- (N) Site: description of general location of sample collection
	- (O) VolumeFiltered: volume of water filtered in liters. For 2021 and 2022 TERN samples, these numbers are "assumed" based on sampling protocols for the year, for other samples the volumes were specifically recorded in the field metadata.
	- (P) NumFiltersUsed: number of filters used to collect the replicate. These data were not collected consistently across years and projects.
	- (Q) Lat: replicate collection latitude in decimal degrees
	- (R) Lon: replicate collection longitude in decimal degrees
	- (S) SamplingNotes: field notes associated with replicate
	- (T) Disposition: current location of physical sample
	- (U) Vessel: research vessel sample was collected from. left blank if sample was collected from shore.
	- (V) Salinity: water salinity in specific gravity at sampling location. one reading was recorded per sample and all replicates from that sample were assumed to have the same value. these data were not collected for all years and projects.
	- (W) Temp: water temperature in degrees celcius at sampling location. one reading was recorded per sample and all replicates from that sample were assumed to have the same value. these data were not collected for all years and projects.
	- (X) ProcessingInfo: information on which team processed the samples
	- (Y) ProcessingNotes: notes associated with sample processing information (column X)
	- (Z) Well: well in sampling plate that sample was placed in during sequencing? these data only exist for 2022 Tern samples processed by the hubbard genome center. 
	- (AA) WaterDepth: water depth reading from vessel sonar in feet at sampling location.
	- (AB) NiskinDepth: estimated depth that the niskin bottle was deployed to in feet.
	- (AC) Habitat: description of habitat type for each sampling location.

## MBON_TERNS_OCT10BLAST_GBIF_CORRECTED_SequencingMetadata
- `.xslx` file containing the same information as the "metadata" sheet in MBON_TERNS_OCT10BLAST_GBIF_CORRECTED
- changes made: tern samples from 2022 were labeled 1-1,1-2,1-3, etc, which leds to formatting issues in excel. The sample IDs for those samples were changed to 1_1,1_2, etc. in row 1 columns KJ-NP
- column info: see column info for "metadata" sheet in MBON_TERNS_OCT10BLAST_GBIF_CORRECTED

## mbon_area_GBIF_fish_species_list
- `.xslx` file containing fish species and the corresponding numbers of observations found in GBIF
- column info:
	- Number of Observ. in GBIF (A): number of observations of species within the GBIF buffer area
	- Level (E): taxonomic level
	- ID (G): unique species ID assigned by GBIF ---JEFF?
        - Species have a unique numeric ID in GBIF. 
